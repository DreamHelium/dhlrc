# 投影文件阅读器

**提示：因为是后写的所以暂时和英文版不太一样，凑合先吧**

## 简介

虽说它名为“投影文件阅读器”，但此程序立项时的目的其实是**处理材料列表，拆分出可合成物品的配方表**，奈何要给外置程序处理的话使用翻译后的名称会有很大麻烦（投影模组默认导出时是已经翻译后的物品名而不是ID，要处理还需得到原本ID，比较麻烦，而且官方还会微改翻译，~比如平滑石**头**台阶~），还需要指定版本。~虽然说调试时拿1.18的翻译文件处理原生投影文件也出现了翻译未出现的情况~

## 依赖

- `zlib`
- `cJSON >= 1.7.13`（~正好用上了两个这版本增加的函数~）

## 编译

建议在编译使用的计算机中安装`git`，获取此仓库后获取submodule。

```bash
git submodule update --init
```

然后手动将`cJSON`目录改为`cjson`（或者安装`cJSON-devel`/`libcjson-dev`并确保版本号大于1.7.13）。如果包版本不满足要求，在`CMakeLists.txt`中的`add_execuable`中添加`cjson/cJSON.h`和`cjson/cJSON.c`（因为安装cJSON开发包后目录是/usr/include/cjson，所以改目录以适应代码，~当然我懒得试~）。

如果有CMake，可以直接使用这下两行编译：

```bash
cmake -B build
cmake --build build
```

如果没有，就用老办法，记得**链接zlib和cJSON库就行（参考英文版）**

开发时用的是Qt Creator，所以你也可以打开里面的.pro文件，配置一下就能用了。

## 使用

现在暂时没有对未放置合适文件的警告说明，但是如果需要的话，将项目的`config/`文件夹放入到可执行文件目录中，以使用目录下的黑名单和替换表（而不是我之前调试时写的一些“算是常见的”）。

在`.minecraft/assets/indexes`中找到需要版本的翻译文件的对应值，在`objects/`目录中进行查找（以头2字符为首的文件夹），复制到可执行目录中并改名为`translation.json`。当然没有翻译一样可以运行。

将对应的版本的jar包进行拆包后将`data/minecraft/recipes`文件夹的内容原封不动地放置到可执行文件目录下的`recipes`目录中，以使用**实验性的**配方表合成。

现在已经提供了NBT阅读器、投影文件材料列表生成器兼实验性的配方合成功能及投影文件区域的方块阅读器（只能读方块，后续会加入即时启动阅读器并提供有用信息的功能）。

## 开发、学习、改进此程序时可以了解的细节

* `nbt_litereader.h`中提供了NBT简易阅读器的入口，加载好NBT文件后通过`nbtlr_Start(NBT变量名, NULL);`即可进入此阅读器。
* `dh_string_util.h`（由“梦氦”写的字符串处理工具，但其实是**针对输入的情况居多**）
  - `InputLine_Get_OneOpt`得到一个数字或者不获取数字（含对**自然数**（即不含负数）的大小检查，暂时不支持关闭）且能检测对单个字符的检查（支持多种），对输入中断的异常处理。
    - 定义
      ```c
      char* InputLine_Get_OneOpt(int need_num, int min, int max, int arg_num, ...);
      ```
    - 使用
      `need_num`指定是否需要数字，0以禁用。
      `min`与`max`为大小限定，`arg_num`是所需检查的字符数，后接需要的字符，如`'q','b'`。
      成功时，数字则返回输入值，字符则为`malloc()`分配的可储存两字符内存的指针，失败返回NULL，成功返回的值均需`free()`释放。
  - `InputLine_Get_MoreDigits`与上述函数类似，不过能处理更多的数字（与上述类似，同样不支持关闭大小检查且**需在可变参数处输入大小值限定后再紧跟字符**），对输入中断的异常处理。
    - 使用
      在上面写了……不过有一点注意，成功时数字不可能返回数字数组，由以下函数进行导出。
  - `NumArray_From_String`从字符串中抽离数组
    - 定义
      ```c
      long* NumArray_From_String(const char* string, int* nums, int char_check);
      ```
    - 使用
      `nums`指向的值将会变为数组元素个数，`char_check`非零时进行字符检查，若出现非数字字符、非回车或‘\0’则返回NULL。
* 懒得写了，其他先看英文版的（虽然不全，最近加了好多新函数）。
